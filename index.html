<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carbon Emissions Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    svg {
      display: block;
      margin: auto;
    }
    .tooltip {
      position: absolute;
      text-align: center;
      padding: 6px;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border-radius: 4px;
      pointer-events: none;
      visibility: hidden;
    }
    .legend rect {
      stroke-width: 1;
      stroke: #ccc;
    }
  </style>
</head>
<body>
  <h1 style="text-align:center">Global Carbon Emissions Visualization</h1>

  <div id="sankey"></div>
  <div id="stacked"></div>
  <div id="boxplot"></div>
  <div id="heatmap"></div>
  <div class="tooltip" id="tooltip"></div>

  <script>
    const tooltip = d3.select("#tooltip");

    // ==== Sample Data for Each Chart Type (You should replace with actual data) ====
    const sankeyData = {
      nodes: [
        { name: "Fossil Fuels" },
        { name: "Transportation" },
        { name: "Industry" },
        { name: "Residential" }
      ],
      links: [
        { source: 0, target: 1, value: 20 },
        { source: 0, target: 2, value: 10 },
        { source: 0, target: 3, value: 5 }
      ]
    };

    const stackedData = [
      { year: 2000, USA: 5000, China: 4000, EU: 3000 },
      { year: 2005, USA: 5200, China: 6000, EU: 3100 },
      { year: 2010, USA: 4800, China: 8000, EU: 2900 },
      { year: 2015, USA: 4700, China: 9500, EU: 2800 }
    ];

    const boxplotData = [
      { region: "USA", values: [30, 35, 40, 45, 50, 55, 60] },
      { region: "China", values: [40, 45, 55, 60, 65, 70, 80] },
      { region: "EU", values: [20, 25, 30, 35, 38, 40, 42] }
    ];

    const heatmapData = [];
    const countries = ["USA", "China", "EU"];
    const years = ["2000", "2005", "2010", "2015"];
    countries.forEach((country, i) => {
      years.forEach((year, j) => {
        heatmapData.push({
          country,
          year,
          value: Math.floor(Math.random() * 100 + 100)
        });
      });
    });

    // === Sankey Diagram ===
    function drawSankey() {
      const width = 600, height = 300;
      const svg = d3.select("#sankey")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const sankey = d3.sankey()
        .nodeWidth(20)
        .nodePadding(20)
        .extent([[1, 1], [width - 1, height - 6]]);

      const graph = sankey({
        nodes: sankeyData.nodes.map(d => Object.assign({}, d)),
        links: sankeyData.links.map(d => Object.assign({}, d))
      });

      svg.append("g")
        .selectAll("rect")
        .data(graph.nodes)
        .join("rect")
        .attr("x", d => d.x0)
        .attr("y", d => d.y0)
        .attr("height", d => d.y1 - d.y0)
        .attr("width", d => d.x1 - d.x0)
        .attr("fill", "#69b3a2")
        .append("title")
        .text(d => d.name);

      svg.append("g")
        .attr("fill", "none")
        .attr("stroke-opacity", 0.5)
        .selectAll("g")
        .data(graph.links)
        .join("path")
        .attr("d", d3.sankeyLinkHorizontal())
        .attr("stroke", "#000")
        .attr("stroke-width", d => Math.max(1, d.width))
        .on("mouseover", (event, d) => {
          tooltip.style("visibility", "visible")
            .text(`${d.source.name} â†’ ${d.target.name}: ${d.value}`);
        })
        .on("mousemove", event => {
          tooltip.style("top", (event.pageY + 10) + "px")
            .style("left", (event.pageX + 10) + "px");
        })
        .on("mouseout", () => tooltip.style("visibility", "hidden"));
    }

    // === Stacked Bar Chart ===
    function drawStackedBar() {
      const width = 600, height = 300, margin = { top: 20, right: 20, bottom: 40, left: 50 };
      const svg = d3.select("#stacked")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const keys = ["USA", "China", "EU"];

      const x = d3.scaleBand()
        .domain(stackedData.map(d => d.year))
        .range([margin.left, width - margin.right])
        .padding(0.1);

      const y = d3.scaleLinear()
        .domain([0, d3.max(stackedData, d => d.USA + d.China + d.EU)]).nice()
        .range([height - margin.bottom, margin.top]);

      const color = d3.scaleOrdinal()
        .domain(keys)
        .range(d3.schemeSet2);

      const stack = d3.stack().keys(keys);
      const series = stack(stackedData);

      svg.append("g")
        .selectAll("g")
        .data(series)
        .join("g")
        .attr("fill", d => color(d.key))
        .selectAll("rect")
        .data(d => d)
        .join("rect")
        .attr("x", d => x(d.data.year))
        .attr("y", d => y(d[1]))
        .attr("height", d => y(d[0]) - y(d[1]))
        .attr("width", x.bandwidth())
        .on("mouseover", (event, d) => {
          const country = event.target.__data__.data;
          tooltip.style("visibility", "visible")
            .text(JSON.stringify(country));
        })
        .on("mousemove", event => {
          tooltip.style("top", (event.pageY + 10) + "px")
            .style("left", (event.pageX + 10) + "px");
        })
        .on("mouseout", () => tooltip.style("visibility", "hidden"));
    }

    // === Boxplot (Simplified) ===
    function drawBoxplot() {
      const width = 600, height = 300, margin = { top: 20, right: 20, bottom: 40, left: 50 };
      const svg = d3.select("#boxplot")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const regions = boxplotData.map(d => d.region);
      const x = d3.scaleBand().domain(regions).range([margin.left, width - margin.right]).padding(0.2);
      const y = d3.scaleLinear().domain([0, 100]).nice().range([height - margin.bottom, margin.top]);

      svg.append("g")
        .selectAll("rect")
        .data(boxplotData)
        .join("rect")
        .attr("x", d => x(d.region))
        .attr("y", d => y(d3.quantile(d.values, 0.75)))
        .attr("height", d => y(d3.quantile(d.values, 0.25)) - y(d3.quantile(d.values, 0.75)))
        .attr("width", x.bandwidth())
        .attr("fill", "#4682b4")
        .on("mouseover", (event, d) => {
          tooltip.style("visibility", "visible")
            .text(`${d.region}: Q1=${d3.quantile(d.values, 0.25)}, Median=${d3.median(d.values)}, Q3=${d3.quantile(d.values, 0.75)}`);
        })
        .on("mousemove", event => {
          tooltip.style("top", (event.pageY + 10) + "px")
            .style("left", (event.pageX + 10) + "px");
        })
        .on("mouseout", () => tooltip.style("visibility", "hidden"));
    }

    // === Heatmap ===
    function drawHeatmap() {
      const width = 600, height = 300, margin = { top: 20, right: 20, bottom: 40, left: 50 };
      const svg = d3.select("#heatmap")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const x = d3.scaleBand().domain(years).range([margin.left, width - margin.right]).padding(0.05);
      const y = d3.scaleBand().domain(countries).range([margin.top, height - margin.bottom]).padding(0.05);
      const color = d3.scaleSequential(d3.interpolateOranges)
        .domain([100, 200]);

      svg.selectAll()
        .data(heatmapData)
        .join("rect")
        .attr("x", d => x(d.year))
        .attr("y", d => y(d.country))
        .attr("width", x.bandwidth())
        .attr("height", y.bandwidth())
        .attr("fill", d => color(d.value))
        .on("mouseover", (event, d) => {
          tooltip.style("visibility", "visible").text(`${d.country} ${d.year}: ${d.value}`);
        })
        .on("mousemove", event => {
          tooltip.style("top", (event.pageY + 10) + "px")
            .style("left", (event.pageX + 10) + "px");
        })
        .on("mouseout", () => tooltip.style("visibility", "hidden"));
    }

    // === Init ===
    drawSankey();
    drawStackedBar();
    drawBoxplot();
    drawHeatmap();
  </script>
</body>
</html>
